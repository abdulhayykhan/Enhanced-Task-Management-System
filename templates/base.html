<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <!-- Notification Toast Container -->
  <div class="position-fixed top-0 end-0 p-3" style="z-index: 11">
    <div id="notification-toast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <strong class="me-auto">Notification</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body" id="notification-message">
        <!-- Notification message will be inserted here -->
      </div>
    </div>
  </div>

  <div class="container py-4">
    <h1 class="text-center mb-4">Task Management System</h1>
    
    <!-- Notifications Alert -->
    <div id="notifications-alert" class="alert alert-info d-none">
      <div id="notifications-content"></div>
    </div>
    
    {% block content %}{% endblock %}
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- WebSocket for Real-time Notifications -->
  <script>
    {% if current_user %}
    const userId = {{ current_user.id }};
    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    const ws = new WebSocket(`${wsProtocol}//${window.location.host}/ws/${userId}`);
    
    ws.onmessage = function(event) {
      try {
        const notification = JSON.parse(event.data);
        showNotification(notification.message);
      } catch (e) {
        // Fallback for simple text messages
        showNotification(event.data);
      }
    };
    
    ws.onerror = function(error) {
      console.log('WebSocket error:', error);
    };
    
    ws.onclose = function() {
      console.log('WebSocket connection closed');
    };
    
    function showNotification(message) {
      const toastElement = document.getElementById('notification-toast');
      const messageElement = document.getElementById('notification-message');
      messageElement.textContent = message;
      
      const toast = new bootstrap.Toast(toastElement);
      toast.show();
    }
    {% endif %}
  </script>
</body>
</html>