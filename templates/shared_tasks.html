{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>{{ page_title }}</h2>
  <div>
    <a href="/" class="btn btn-secondary">My Tasks</a>
    <a href="/notifications" class="btn btn-warning">Notifications</a>
    <a href="/analytics" class="btn btn-success">Analytics</a>
    <a href="/logout" class="btn btn-outline-secondary">Logout</a>
  </div>
</div>

<!-- Toggle between views -->
<div class="mb-4">
  <div class="btn-group" role="group">
    <a href="/shared-tasks?view=with-me" class="btn {% if view == 'with-me' %}btn-primary{% else %}btn-outline-primary{% endif %}">
      Tasks Shared with Me
    </a>
    <a href="/shared-tasks?view=by-me" class="btn {% if view == 'by-me' %}btn-primary{% else %}btn-outline-primary{% endif %}">
      Tasks I've Shared
    </a>
  </div>
</div>

{% if tasks %}
<div class="table-responsive">
  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Status</th>
        <th>Due Date</th>
        {% if view == 'with-me' %}
        <th>Shared By</th>
        {% else %}
        <th>Shared With</th>
        {% endif %}
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for task in tasks %}
      <tr>
        <td><a href="/tasks/{{ task.id }}" class="text-decoration-none">{{ task.title }}</a></td>
        <td>{{ task.description if task.description else "No description" }}</td>
        <td>
          <span class="badge {% if task.status == 'Completed' %}bg-success{% elif task.status == 'In Progress' %}bg-warning{% else %}bg-secondary{% endif %}">
            {{ task.status }}
          </span>
        </td>
        <td>{{ task.due_date if task.due_date else "No due date" }}</td>
        <td>
          {% if view == 'with-me' %}
            <!-- Show who shared the task with the current user -->
            {% if task.owner %}
              {{ task.owner.name }} ({{ task.owner.email }})
            {% else %}
              Unknown
            {% endif %}
          {% else %}
            <!-- Show who the task is shared with -->
            <div class="d-flex flex-wrap gap-1">
              {% for user in task.shared_with %}
                <span class="badge bg-secondary">{{ user.name }}</span>
              {% endfor %}
            </div>
          {% endif %}
        </td>
        <td>
          <div class="btn-group btn-group-sm" role="group">
            {% if view == 'with-me' %}
              <!-- Tasks shared with me - view only -->
              <a href="/tasks/{{ task.id }}" class="btn btn-outline-primary">View</a>
            {% else %}
              <!-- Tasks I've shared - full control -->
              <a href="/tasks/{{ task.id }}/edit" class="btn btn-outline-warning">Edit</a>
              <a href="/tasks/{{ task.id }}/share" class="btn btn-outline-info">Manage Sharing</a>
              <a href="/tasks/{{ task.id }}/delete" class="btn btn-outline-danger" onclick="return confirm('Are you sure you want to delete this task?')">Delete</a>
            {% endif %}
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<div class="text-center py-5">
  <div class="mb-4">
    {% if view == 'with-me' %}
      <i class="fas fa-share-alt" style="font-size: 4rem; color: #6c757d;"></i>
    {% else %}
      <i class="fas fa-users" style="font-size: 4rem; color: #6c757d;"></i>
    {% endif %}
  </div>
  <h4 class="text-muted mb-3">No {{ 'shared' if view == 'with-me' else 'tasks shared by you' }} tasks yet</h4>
  {% if view == 'with-me' %}
    <p class="text-muted mb-4">When others share tasks with you, they'll appear here for collaboration.</p>
    <a href="/" class="btn btn-outline-primary btn-lg px-4">View My Tasks</a>
  {% else %}
    <p class="text-muted mb-4">Share your tasks with others to collaborate and work together!</p>
    <a href="/" class="btn btn-primary btn-lg px-4">Go to My Tasks</a>
  {% endif %}
</div>
{% endif %}

{% endblock %}